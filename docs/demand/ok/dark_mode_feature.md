# 深色模式功能需求文檔

## 文件資訊

- **文件名稱**：深色模式功能需求文檔
- **版本**：1.0
- **最後更新日期**：2024 年 5 月 29 日
- **狀態**：已實現
- **作者**：firstfu

## 需求分析

### 背景

隨著移動應用的發展，深色模式已成為現代應用不可或缺的功能。為了提升用戶在不同光線環境下的使用體驗，特別是在夜間或光線較弱環境下減少眼睛疲勞，「血壓管家」應用需要實現全面的深色模式支持。除了提升使用舒適度外，在 OLED 屏幕的設備上，深色模式還能節省電量，延長電池壽命。

### 目標

1. 提供完整的深色模式支持，涵蓋應用所有頁面和元件
2. 實現基於系統設置的自動切換功能
3. 提供手動切換選項，滿足用戶個人偏好
4. 確保深色模式下的視覺舒適度和可讀性
5. 設計考慮可訪問性標準，特別是色彩對比度

### 功能需求

1. **主題切換機制**：

   - 支持三種模式：淺色模式、深色模式、跟隨系統設置
   - 提供主題設置頁面，允許用戶手動切換
   - 記住用戶選擇，下次啟動時自動應用

2. **全局深色模式支持**：

   - 所有頁面和元件都適配深色主題
   - 包括主頁、記錄頁、統計頁、設置頁等
   - 所有彈窗、對話框、底部菜單等均支持深色模式

3. **數據視覺化適配**：

   - 圖表、趨勢線和數據視覺化元素適配深色背景
   - 確保在深色模式下數據依然清晰可讀
   - 保持血壓分類的顏色標識在深色模式下的辨識度

4. **設計規範**：
   - 深色背景使用暗灰色（#121212）而非純黑，減少眼睛疲勞
   - 主色調在深色模式下調整為更亮的藍色，提高可見度
   - 保持足夠的對比度，符合 WCAG AA 級別標準

### 非功能需求

1. **性能**：主題切換應流暢，不應造成明顯的卡頓或閃爍
2. **兼容性**：適配 Android 10+ 和 iOS 13+ 的系統深色模式
3. **響應性**：系統深色模式變更時，應用應立即響應
4. **持久性**：用戶的主題偏好應在應用重啟後保持

## 技術架構

### 核心組件

1. **ThemeProvider**：

   - 管理應用主題狀態
   - 提供主題切換方法
   - 響應系統主題變化
   - 保存用戶主題偏好

2. **ThemeData 配置**：

   - 分別定義淺色主題和深色主題
   - 包括顏色、字體、陰影等所有主題相關屬性

3. **SharedPreferences**：
   - 存儲用戶的主題偏好設置
   - 在應用啟動時讀取設置

### 實現方案

1. **主題系統設計**

   - 創建完整的深色模式主題，定義所有顏色和樣式
   - 使用 Flutter 的 ThemeData 進行統一管理
   - 針對深色模式特別優化的顏色方案

2. **主題管理**

   - 使用 Provider 管理主題狀態
   - 使用 SharedPreferences 保存用戶主題偏好
   - 提供主題切換功能

3. **系統集成**

   - 監聽系統深色模式設定變化
   - 在啟動時根據系統設定或用戶偏好設定應用主題
   - 提供手動切換選項

4. **UI 組件適配**
   - 所有自定義組件適配深色模式
   - 使用相對顏色引用而非硬編碼顏色值
   - 確保足夠的對比度和可讀性

## 進度拆解

1. **設計與規劃階段**（已完成）

   - [x] 定義深色模式下的設計規範
   - [x] 創建深色模式調色板
   - [x] 確定主要界面元素在深色模式下的外觀

2. **基礎實現階段**（已完成）

   - [x] 實現 ThemeProvider
   - [x] 配置淺色和深色 ThemeData
   - [x] 實現主題持久化存儲

3. **UI 適配階段**（已完成）

   - [x] 適配主頁面和底部導航
   - [x] 適配記錄頁面
   - [x] 適配統計分析頁面
   - [x] 適配設置頁面
   - [x] 適配彈窗和對話框

4. **設置界面階段**（已完成）

   - [x] 創建主題設置頁面
   - [x] 實現三種模式的切換功能
   - [x] 設計直觀的用戶界面

5. **測試與優化階段**（已完成）
   - [x] 在不同設備上測試主題切換
   - [x] 優化色彩對比度和可讀性
   - [x] 修復發現的問題

## 設計考量

### 顏色選擇原則

1. **背景顏色**

   - 使用暗灰色（#121212）作為主要背景色，而非純黑色
   - 不同層級的表面使用略微不同的顏色，創建層次感

2. **文字顏色**

   - 主要文字使用白色（#FFFFFF），但降低透明度至 87% 減少眼睛疲勞
   - 次要文字使用較低透明度的白色（60%）
   - 禁用或提示文字使用更低透明度（38%）

3. **強調色**

   - 使用較亮的藍色（#90CAF9）代替原主題藍色（#1976D2）
   - 確保足夠的對比度，增強可讀性

4. **狀態顏色**
   - 錯誤色：較淺的紅色（#CF6679）
   - 成功色：調整為較淺的綠色（#03DAC6）
   - 警告色：調整為較暗的橙色（#FF9E40）

### 對比度與可讀性

- 確保文字與背景的對比度達到 WCAG AA 標準（4.5:1）
- 使用較大的字體大小和增加字重來增強可讀性
- 避免使用低飽和度和低對比度的顏色組合

### 圖表與數據視覺化

- 為圖表設計專用的深色模式配色方案
- 增加線條粗細和數據點大小
- 使用更明亮的顏色表示重要數據
- 添加適當的網格線幫助區分數據

## 風險評估

1. **風險**：不同屏幕技術（LCD 與 OLED）顯示差異

   - **緩解**：在不同類型的設備上測試並調整顏色

2. **風險**：用戶可能發現某些深色模式下的元素難以辨識

   - **緩解**：增加關鍵元素的視覺差異性，如添加邊框或陰影

3. **風險**：主題切換可能導致性能問題

   - **緩解**：優化主題切換邏輯，減少不必要的重建

4. **風險**：與第三方組件的兼容性問題
   - **緩解**：為第三方組件創建深色模式包裝器或覆蓋樣式

## 效益分析

1. **用戶體驗提升**：

   - 降低夜間使用時的眼睛疲勞
   - 提供更現代化的視覺體驗
   - 讓用戶根據個人偏好選擇主題

2. **功能競爭力**：

   - 跟上行業趨勢，提高應用競爭力
   - 符合現代設計標準

3. **硬件優勢**：
   - 在 OLED 屏幕設備上節省電量
   - 減少屏幕發熱

## 相關資源

- [Material Design 深色主題指南](https://material.io/design/color/dark-theme.html)
- [iOS 人機界面指南 - 深色模式](https://developer.apple.com/design/human-interface-guidelines/dark-mode)
- [WCAG 色彩對比度指南](https://www.w3.org/WAI/WCAG21/Understanding/contrast-minimum.html)

## 結論

深色模式功能的實現將顯著提升「血壓管家」應用的用戶體驗，特別是在夜間和弱光環境下。通過遵循現代設計標準和可訪問性原則，我們可以為用戶提供一個更舒適、更有效的血壓管理工具。同時，這也使應用與主流設計趨勢保持同步，增強其市場競爭力。
