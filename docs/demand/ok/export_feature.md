# 血壓記錄匯出功能需求文檔

> **完成日期：2024 年 3 月 23 日**

## 功能概述

在血壓記錄 App 中添加匯出功能，讓用戶可以將血壓記錄數據匯出為 CSV 或 Excel 格式，方便用戶在其他應用程式中查看、分析或保存數據。

## 需求背景

用戶需要將血壓記錄數據匯出到其他應用程式中進行更深入的分析或長期保存。目前應用已有 PDF 報告生成功能，但 PDF 格式不便於數據的二次處理，因此需要提供更靈活的數據匯出選項。

## 功能詳情

### 1. 匯出格式

- **CSV 格式**：通用的表格數據格式，可被 Excel、Google 試算表等應用程式開啟
- **Excel 格式**：直接生成 Excel 文件，包含格式化和顏色標記，提供更好的視覺體驗

### 2. 匯出內容

匯出的數據應包含以下字段：

- 測量時間
- 收縮壓 (mmHg)
- 舒張壓 (mmHg)
- 心率 (bpm)
- 測量姿勢
- 測量部位
- 是否服藥
- 備註
- 血壓狀態

### 3. 匯出入口

在應用中提供兩個匯出入口：

- 統計頁面頂部的匯出按鈕（與生成報告按鈕並列）
- 歷史記錄頁面的匯出按鈕（與篩選按鈕並列）

### 4. 匯出流程

1. 用戶點擊匯出按鈕
2. 彈出底部選單，讓用戶選擇匯出格式（CSV 或 Excel）
3. 系統生成相應格式的文件
4. 調用系統分享功能，讓用戶選擇將文件分享到其他應用程式或保存到本地

### 5. 格式化要求

#### CSV 格式

- 包含標題行
- 使用標準 CSV 格式，確保與各種應用程式兼容

#### Excel 格式

- 包含標題行，使用藍色背景和白色文字
- 根據血壓狀態為數據行設置不同的背景顏色：
  - 正常：淺綠色
  - 偏高：淺橙色
  - 高血壓 1 級：淺紅色
  - 高血壓 2 級：中紅色
  - 高血壓危象：深紅色
- 調整列寬，確保數據顯示完整

## 技術實現

### 1. 依賴庫

- `csv: ^5.1.1`：用於生成 CSV 格式文件
- `excel: ^4.0.2`：用於生成 Excel 格式文件
- `path_provider`：用於獲取臨時目錄
- `share_plus`：用於分享文件

### 2. 實現方案

1. 在 `ReportService` 類中添加兩個新方法：

   - `generateCSV`：生成 CSV 格式文件
   - `generateExcel`：生成 Excel 格式文件

2. 在 `StatsPage` 中直接實現匯出功能：

   - `_showExportOptions`：顯示匯出選項底部選單
   - `_exportData`：處理匯出數據邏輯

3. 在 `StatsDataTableTab` 中添加匯出按鈕，連接到 `StatsPage` 的匯出功能

## 進度計劃

- [x] 添加 CSV 和 Excel 依賴庫
- [x] 實現 CSV 生成功能
- [x] 實現 Excel 生成功能
- [x] 添加匯出按鈕和選項菜單
- [x] 連接 UI 和功能
- [x] 測試不同格式的匯出功能
- [x] 優化匯出文件的格式和樣式
- [x] 添加多語言支持
- [x] 清理代碼，移除未使用的組件

## 預期效果

用戶可以方便地將血壓記錄數據匯出為 CSV 或 Excel 格式，並分享到其他應用程式或保存到本地，便於數據的二次處理和長期保存。這將提升應用的實用性和用戶體驗。
