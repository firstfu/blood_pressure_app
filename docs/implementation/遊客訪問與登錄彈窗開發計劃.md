/\*

- @ Author: firstfu
- @ Create Time: 2024-03-28 20:02:03
- @ Description: 遊客訪問與登錄彈窗功能的開發計劃和時間表
  \*/

# 遊客訪問與登錄彈窗開發計劃

## 一、概述

本開發計劃詳細說明遊客訪問與登錄彈窗功能的實現步驟、時間安排以及任務分配。

## 二、開發階段

### 第一階段：準備工作（1 天）

**目標**：設置基礎架構，為功能實現做準備

**任務**：

1. 分析現有代碼結構
2. 設計認證數據模型
3. 規劃服務層架構
4. 制定 UI 設計規範

**具體操作**：

- 創建 `lib/constants/auth_constants.dart`
- 擴展 `lib/models/user_profile.dart` 模型
- 設計 `AuthService` 接口定義
- 建立 UI 設計規範文檔

**時間**：3 月 29 日

### 第二階段：認證服務實現（1 天）

**目標**：實現用戶認證核心服務

**任務**：

1. 實現 `AuthService` 服務類
2. 加入遊客模式邏輯
3. 實現登入/註冊功能
4. 整合到應用啟動流程

**具體操作**：

- 創建 `lib/services/auth_service.dart`
- 擴展 `SharedPrefsService` 添加用戶數據持久化
- 修改 `main.dart` 實現服務註冊和初始化
- 設計並實現遊客用戶創建邏輯

**時間**：3 月 30 日

### 第三階段：UI 組件開發（2 天）

**目標**：開發登入/註冊彈窗和相關 UI 組件

**任務**：

1. 實現登入彈窗組件
2. 設計登入/註冊表單
3. 實現表單驗證邏輯
4. 設計狀態管理和錯誤處理

**具體操作**：

- 創建 `lib/widgets/auth/login_dialog.dart`
- 創建 `lib/utils/dialog_utils.dart`
- 實現表單驗證邏輯
- 設計錯誤處理機制

**時間**：3 月 31 日 - 4 月 1 日

### 第四階段：業務邏輯整合（1 天）

**目標**：將認證機制整合到現有應用流程中

**任務**：

1. 實現權限控制層
2. 在各 CRUD 操作前添加權限檢查
3. 優化用戶流程體驗
4. 確保數據一致性

**具體操作**：

- 創建 `lib/utils/permission_handler.dart`
- 修改血壓記錄相關視圖
- 修改用戶資料相關視圖
- 修改歷史記錄相關視圖

**時間**：4 月 2 日

### 第五階段：測試與優化（1 天）

**目標**：全面測試功能並進行優化

**任務**：

1. 進行功能測試
2. 測試各種用戶場景
3. 修復發現的問題
4. 優化用戶體驗

**具體操作**：

- 測試遊客模式功能
- 測試登入/註冊流程
- 測試權限控制機制
- 優化 UI 和交互體驗

**時間**：4 月 3 日

## 三、具體任務拆解

### Day 1（3 月 29 日）- 準備工作

| 時間        | 任務                   | 說明                       |
| ----------- | ---------------------- | -------------------------- |
| 09:00-10:30 | 需求分析與代碼結構評估 | 詳細分析需求，確定開發範圍 |
| 10:30-12:00 | 設計認證數據模型       | 擴展 UserProfile 模型      |
| 13:00-15:00 | 規劃服務層架構         | 設計 AuthService 接口      |
| 15:00-17:00 | 制定 UI 設計規範       | 設計登入彈窗 UI 規範       |
| 17:00-18:00 | 日進度回顧             | 檢查當天完成情況，調整計劃 |

### Day 2（3 月 30 日）- 認證服務實現

| 時間        | 任務                      | 說明                   |
| ----------- | ------------------------- | ---------------------- |
| 09:00-11:00 | 實現 AuthService 核心邏輯 | 編寫 auth_service.dart |
| 11:00-12:30 | 實現遊客模式邏輯          | 添加遊客用戶創建與判斷 |
| 13:30-15:30 | 擴展 SharedPrefsService   | 添加用戶數據持久化方法 |
| 15:30-17:00 | 整合到應用啟動流程        | 修改 main.dart         |
| 17:00-18:00 | 認證服務測試              | 測試核心認證功能       |

### Day 3-4（3 月 31 日 - 4 月 1 日）- UI 組件開發

#### Day 3（3 月 31 日）

| 時間        | 任務             | 說明                          |
| ----------- | ---------------- | ----------------------------- |
| 09:00-12:00 | 設計登入彈窗佈局 | 實現 LoginDialog 組件基本結構 |
| 13:00-15:30 | 實現登入表單邏輯 | 添加表單和控制器              |
| 15:30-18:00 | 實現註冊表單邏輯 | 實現模式切換和相關邏輯        |

#### Day 4（4 月 1 日）

| 時間        | 任務               | 說明                   |
| ----------- | ------------------ | ---------------------- |
| 09:00-11:00 | 實現表單驗證邏輯   | 添加輸入驗證機制       |
| 11:00-13:00 | 實現錯誤處理機制   | 處理登入/註冊錯誤情況  |
| 14:00-16:00 | 實現全局對話框工具 | 創建 dialog_utils.dart |
| 16:00-18:00 | UI 測試與調整      | 測試各種屏幕尺寸和情景 |

### Day 5（4 月 2 日）- 業務邏輯整合

| 時間        | 任務             | 說明                          |
| ----------- | ---------------- | ----------------------------- |
| 09:00-11:00 | 實現權限控制層   | 創建 PermissionHandler 類     |
| 11:00-13:00 | 血壓記錄功能整合 | 在添加/編輯記錄前添加權限檢查 |
| 14:00-16:00 | 用戶資料功能整合 | 在編輯個人資料前添加權限檢查  |
| 16:00-18:00 | 歷史記錄功能整合 | 在查看歷史記錄前添加權限檢查  |

### Day 6（4 月 3 日）- 測試與優化

| 時間        | 任務              | 說明                   |
| ----------- | ----------------- | ---------------------- |
| 09:00-11:00 | 遊客模式功能測試  | 測試遊客訪問限制       |
| 11:00-13:00 | 登入/註冊流程測試 | 測試認證流程完整性     |
| 14:00-16:00 | 問題修復          | 修復測試中發現的問題   |
| 16:00-17:30 | 用戶體驗優化      | 優化交互和視覺體驗     |
| 17:30-18:00 | 項目總結          | 總結開發成果，記錄經驗 |

## 四、關鍵文件變更清單

| 文件路徑                               | 變更類型 | 內容說明                       |
| -------------------------------------- | -------- | ------------------------------ |
| lib/models/user_profile.dart           | 修改     | 擴展用戶模型，添加認證相關屬性 |
| lib/constants/auth_constants.dart      | 新建     | 定義認證相關常量和操作類型枚舉 |
| lib/services/auth_service.dart         | 新建     | 實現用戶認證服務類             |
| lib/services/shared_prefs_service.dart | 修改     | 添加用戶數據持久化方法         |
| lib/widgets/auth/login_dialog.dart     | 新建     | 實現登入/註冊彈窗組件          |
| lib/utils/dialog_utils.dart            | 新建     | 提供顯示登入彈窗的工具函數     |
| lib/utils/permission_handler.dart      | 新建     | 實現權限控制邏輯               |
| lib/main.dart                          | 修改     | 註冊認證服務並初始化           |
| lib/views/add_record_screen.dart       | 修改     | 添加權限檢查邏輯               |
| lib/views/history_screen.dart          | 修改     | 添加權限檢查邏輯               |
| lib/views/profile_screen.dart          | 修改     | 添加權限檢查邏輯               |
| lib/views/settings_screen.dart         | 修改     | 添加權限檢查邏輯               |

## 五、測試計劃

### 功能測試

1. **遊客模式測試**

   - 驗證遊客可以瀏覽應用但不能進行 CRUD 操作
   - 驗證遊客模式下的功能限制正確生效

2. **登入/註冊流程測試**

   - 測試登入表單驗證功能
   - 測試註冊表單驗證功能
   - 測試登入成功後的狀態更新
   - 測試登入失敗的錯誤處理

3. **權限控制測試**
   - 測試各種 CRUD 操作的權限控制
   - 驗證登入後權限正確授予
   - 測試取消登入時的行為

### 用戶體驗測試

1. **界面響應測試**

   - 在不同屏幕尺寸下測試彈窗適配性
   - 測試鍵盤彈出時的界面調整

2. **流程順暢度測試**

   - 評估用戶完成登入/註冊的時間
   - 檢查流程中的潛在困惑點

3. **錯誤處理體驗**
   - 評估錯誤提示的清晰度和幫助性
   - 測試用戶從錯誤中恢復的難度

## 六、風險評估與應對措施

| 風險                     | 可能性 | 影響 | 應對措施                                   |
| ------------------------ | ------ | ---- | ------------------------------------------ |
| 認證服務實現延遲         | 中     | 高   | 提前設計接口，準備模擬實現                 |
| UI 組件複雜度超出預期    | 中     | 中   | 採用漸進式開發，先實現基本功能             |
| 與現有代碼整合困難       | 低     | 高   | 詳細分析現有代碼，制定清晰的整合計劃       |
| 用戶體驗不佳導致轉化率低 | 中     | 高   | 進行多輪用戶測試，收集反饋不斷優化         |
| 數據遷移問題             | 低     | 中   | 設計可靠的數據遷移機制，確保遊客數據不丟失 |

## 七、里程碑

| 里程碑           | 完成標準                         | 預計日期   |
| ---------------- | -------------------------------- | ---------- |
| 基礎架構設置完成 | 數據模型和服務接口定義完成       | 3 月 29 日 |
| 認證服務實現完成 | AuthService 核心功能可用         | 3 月 30 日 |
| UI 組件開發完成  | 登入/註冊彈窗可用                | 4 月 1 日  |
| 業務邏輯整合完成 | 所有 CRUD 操作前的權限檢查已實現 | 4 月 2 日  |
| 功能全面測試完成 | 所有功能測試通過，主要問題已修復 | 4 月 3 日  |

## 八、總結

本開發計劃詳細說明了遊客訪問與登錄彈窗功能的實現步驟、時間安排及任務分配。通過 6 天的開發週期，我們將完成從基礎架構設置到最終測試的所有工作。

計劃主要分為五個階段：準備工作、認證服務實現、UI 組件開發、業務邏輯整合以及測試與優化。每個階段有明確的目標、任務和時間安排，確保開發過程有序進行。

通過實現這一功能，我們將顯著提升應用的用戶體驗，降低初次使用門檻，同時確保用戶數據安全和功能完整性。
